<h2>Entity Framework Core - Entity</h2>

<h3>@Model.Entity?.ClrTypeName</h3>


<h3 style="margin-bottom: 10px;">Rows</h3>
<a style="margin-left: 5px;" class="button small" href="/debug/EFEntityEditor?_dbContext=@(Model.AppDbContext)&_entity=@(Model.Entity.ClrTypeName)">Create</a>
<br />
<br />
<div class="text-error">@Model.Rows?.Error</div>
@if (Model.Rows != null)
{
    <form autocomplete="off" method="get">
        <input name="_dbContext" value="@Model.AppDbContext" type="hidden" />
        <input name="_entity" value="@Model.Entity?.ClrTypeName" type="hidden" />
        <table>
            <thead class="small">
                <tr>
                    @foreach (var field in Model.Rows.Fields)
                    {
                        <td>
                            @RenderPartialView("_FieldFilter", field)
                        </td>
                    }
                </tr>
                <tr>
                    <td colspan="1000">
                        <button class="small" name="find">Find</button>
                    </td>
                </tr>
                <tr>
                    @foreach (var field in Model.Rows.Fields)
                    {
                        <td>@field.Name</td>
                    }
                </tr>
            </thead>
            <tbody>
                @foreach (var row in Model.Rows.Rows)
                {
                    <tr>
                        @for (int i = 0; i < Model.Rows.Fields.Count; i++)
                        {
                            <td>

                                @if (Model.Rows.Fields[i].IsPrimaryKey)
                                {
                                    var pk = "";
                                    @foreach (var pkField in Model.Rows.Fields)
                                    {
                                        if (pkField.IsPrimaryKey)
                                        {
                                            int pkIndex = Model.Rows.Fields.IndexOf(pkField);
                                            var pkValue = row[pkIndex];
                                            pk = pk + "&" + pkField.Name + "=" + pkValue;
                                        }
                                    }

                                    <a href="/debug/EFEntityEditor?_dbContext=@(Model.AppDbContext)&_entity=@(Model.Entity.ClrTypeName)@(pk)">
                                        @row[i]
                                    </a>
                                }
                                else
                                {
                                    @row[i]
                                }

                            </td>
                        }
                    </tr>
                }
            </tbody>
        </table>
    </form>
}

<h3>Details</h3>
<table class="form">
    <tr>
        <td>AppDbContext</td>
        <td>@Model.AppDbContext</td>
    </tr>
    <tr>
        <td></td>
        <td>
            <a class="button small" href="/debug/EFContext?_dbContext=@(Model.AppDbContext)">Details</a>
            <a class="button small" href="/debug/EFRunSql?_dbContext=@(Model.AppDbContext)">Run Sql</a>
        </td>
    </tr>
    <tr>
        <td>NavigationName</td>
        <td>@Model.Entity?.NavigationName</td>
    </tr>
    <tr>
        <td>ClrTypeName</td>
        <td>@Model.Entity?.ClrTypeName</td>
    </tr>
    <tr>
        <td>Schema</td>
        <td>@Model.Entity?.Schema</td>
    </tr>
    <tr>
        <td>TableName</td>
        <td>@Model.Entity?.TableName</td>
    </tr>
    <tr>
        <td>SchemaAndTableName</td>
        <td>@Model.Entity?.SchemaAndTableName</td>
    </tr>
</table>

<h3>Fields</h3>
@if (Model.Entity?.Fields != null)
{
    <table>
        <thead class="small">
            <tr>
                <th>Name</th>
                <th>Type</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var field in Model.Entity?.Fields)
            {
                <tr>
                    <td>@field.Name</td>
                    <td>@(field?.FieldInfo?.FieldType?.GetFriendlyName())</td>
                    <td>
                        @(field.IsPrimaryKey ? "PrimaryKey" : "")
                    </td>
                </tr>
            }
        </tbody>
    </table>
}

<h3>DebugView</h3>
<pre>
@Model.Entity?.DebugView
</pre>

